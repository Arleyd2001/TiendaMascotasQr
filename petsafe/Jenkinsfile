pipeline {
    agent any
    
    environment {
        FIREBASE_API_KEY = 'AIzaSyB2B_0uZlrCBRNi0g-_ptS_PDz3vtP_jHU'
        FIREBASE_AUTH_DOMAIN = 'petsafe-a2cff.firebaseapp.com'
        FIREBASE_PROJECT_ID = 'petsafe-a2cff'
        FIREBASE_STORAGE_BUCKET = 'petsafe-a2cff.appspot.com'
        FIREBASE_MESSAGING_SENDER_ID = '232783336193'
        FIREBASE_APP_ID = '1:232783336193:web:104bc1303aa19087484100'
        FIREBASE_MEASUREMENT_ID = 'G-D9TJXPL9CN'
    }

    stages {
        stage('Verificar conexión con Firebase') {
            steps {
                script {
                    // Configuración de Firebase Admin SDK para autenticación
                    def config = '''{
                        "type": "service_account",
                        "project_id": "${FIREBASE_PROJECT_ID}",
                        "private_key_id": "${FIREBASE_PRIVATE_KEY_ID}",
                        "private_key": "${FIREBASE_PRIVATE_KEY}",
                        "client_email": "${FIREBASE_CLIENT_EMAIL}",
                        "client_id": "${FIREBASE_CLIENT_ID}",
                        "auth_uri": "${FIREBASE_AUTH_URI}",
                        "token_uri": "${FIREBASE_TOKEN_URI}",
                        "auth_provider_x509_cert_url": "${FIREBASE_AUTH_PROVIDER_X509_CERT_URL}",
                        "client_x509_cert_url": "${FIREBASE_CLIENT_X509_CERT_URL}"
                    }'''
                    
                    writeFile file: 'firebase-adminsdk.json', text: config
                    
                    // Ejemplo de verificación de conexión
                    try {
                        def adminApp = new FirebaseAdminSDK('firebase-adminsdk.json')
                        adminApp.initializeApp()
                        println 'Conexión exitosa con Firebase'
                    } catch (Exception e) {
                        println "Error de conexión con Firebase: ${e.message}"
                        currentBuild.result = 'FAILURE'
                        error 'Conexión fallida con Firebase'
                    }
                }
            }
        }
    }
}
