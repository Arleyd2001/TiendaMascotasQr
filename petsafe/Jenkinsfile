{
    agent any
    
    environment {
        FIREBASE_PROJECT_ID = 'AIzaSyB2B_0uZlrCBRNi0g-_ptS_PDz3vtP_jHU'
        FIREBASE_API_KEY = credentials('1:232783336193:web:104bc1303aa19087484100')
    }
    
    stages {
        stage('Test de Conexión a Firebase Firestore') {
            steps {
                script {
                    try {
                        // Verificar la conexión a Firebase Firestore
                        sh "npm install -g firebase-tools"
                        sh "firebase login:ci --no-localhost --token $FIREBASE_API_KEY"
                        sh "firebase projects:list --token $FIREBASE_API_KEY"
                        sh "firebase firestore:list --token $FIREBASE_API_KEY"
                    } catch (Exception e) {
                        error "Error al verificar la conexión a Firebase Firestore: ${e.message}"
                    }
                }
            }
        }
        
        stage('Obtener Primeras Tres Mascotas Registradas') {
            steps {
                script {
                    try {
                        // Obtener las primeras tres mascotas registradas desde Firebase Firestore
                        sh "npm install"
                        sh "npm run build"
                        def mascotas = sh(script: 'node -e "require(\'petsafe\src\components\ListaMascotas.jsx')"', returnStdout: true).trim()
                        echo "Primeras tres mascotas registradas: ${mascotas}"
                    } catch (Exception e) {
                        error "Error al obtener las primeras tres mascotas: ${e.message}"
                    }
                }
            }
        }
    }
    
    post {
        always {
            echo "Pipeline finalizado."
        }
    }
}